<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales Data Entry System</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23A3BFFA;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%23FBB6CE;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='80' height='80' x='10' y='10' rx='15' fill='url(%23grad)'/%3E%3Cpath d='M35 65 L65 35 M35 35 L65 65' stroke='white' stroke-width='8' stroke-linecap='round'/%3E%3C/svg%3E">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #A3BFFA;
            --secondary: #FBB6CE;
            --dark: #2D3748;
            --light: #EDF2F7;
            --accent: #BEE3F8;
            --text: #4A5568;
        }
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            color: var(--dark);
            text-align: center;
            margin-bottom: 30px;
            font-size: 2em;
        }
        h1 i {
            margin-right: 10px;
            color: var(--dark);
        }
        .nav-container {
            position: relative;
        }
        .nav-menu {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .nav-item {
            background: var(--light);
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            color: var(--text);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .nav-item:hover {
            background: var(--accent);
            transform: translateY(-2px);
        }
        .nav-item.active {
            background: var(--primary);
            color: white;
        }
        .tab-content {
            display: none;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .form-container {
            margin: 20px 0;
        }
        h2 {
            color: var(--dark);
            margin-bottom: 20px;
            font-size: 1.5em;
        }
        h2 i {
            margin-right: 10px;
        }
        .input-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        .input-group label {
            min-width: 120px;
            color: var(--text);
        }
        .input-group i {
            color: var(--dark);
        }
        input, select {
            padding: 8px;
            border: 1px solid var(--light);
            border-radius: 4px;
            flex: 1;
            min-width: 0;
        }
        input[type="number"] {
            width: 120px;
        }
        .button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        .btn-primary:hover {
            background: var(--accent);
        }
        .btn-danger {
            background: #F56565;
            color: white;
        }
        .btn-danger:hover {
            background: #ED8936;
        }
        .button i {
            margin-right: 5px;
        }
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--light);
        }
        th {
            background: var(--primary);
            color: white;
        }
        th i {
            margin-right: 5px;
        }
        .message {
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .message.success {
            background: #C6F6D5;
            color: #276749;
        }
        .message.error {
            background: #FED7D7;
            color: #9B2C2C;
        }
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: var(--light);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .stat-card i {
            font-size: 2em;
            color: var(--primary);
            margin-bottom: 10px;
        }
        .stat-card h3 {
            color: var(--text);
            margin: 10px 0;
            font-size: 1.2em;
        }
        .stat-card p {
            color: var(--dark);
            font-size: 1.5em;
            margin: 0;
        }
        .hamburger {
            display: none;
            background: none;
            border: none;
            cursor: pointer;
            padding: 10px;
            position: absolute;
            right: 0;
            top: 0;
        }
        .hamburger span {
            display: block;
            width: 25px;
            height: 3px;
            background: var(--dark);
            margin: 5px 0;
            transition: all 0.3s ease;
        }
        .hamburger.open span:nth-child(1) {
            transform: rotate(45deg) translate(5px, 5px);
        }
        .hamburger.open span:nth-child(2) {
            opacity: 0;
        }
        .hamburger.open span:nth-child(3) {
            transform: rotate(-45deg) translate(7px, -7px);
        }
        .sub-menu {
            display: none;
            margin-top: 20px;
            padding: 15px;
            background: var(--light);
            border-radius: 8px;
        }
        .sub-menu h3 {
            color: var(--dark);
            margin-bottom: 15px;
        }
        .sub-menu h3 i {
            margin-right: 10px;
        }
        @media (max-width: 768px) {
            .nav-menu {
                display: none;
                flex-direction: column;
                position: absolute;
                top: 50px;
                right: 0;
                width: 200px;
                background: white;
                padding: 10px;
                border-radius: 8px;
                box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            }
            .nav-menu.open {
                display: flex;
            }
            .hamburger {
                display: block;
            }
            .dashboard-stats {
                grid-template-columns: 1fr;
            }
        }
        .centered-form {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1><i class="fas fa-chart-line"></i> Sales Data Entry System</h1>

        <div class="nav-container">
            <button class="hamburger" onclick="UI.toggleMenu()">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <div class="nav-menu">
                <button class="nav-item active" onclick="UI.openTab('dashboard')"><i class="fas fa-tachometer-alt"></i> Dashboard</button>
                <button class="nav-item" onclick="UI.openTab('sales')"><i class="fas fa-money-bill-wave"></i> Sales Entry</button>
                <button class="nav-item" onclick="UI.openTab('staff')"><i class="fas fa-users"></i> Staff Setup</button>
                <button class="nav-item" onclick="UI.openTab('partStore')"><i class="fas fa-warehouse"></i> Part Store</button>
                <button class="nav-item" onclick="UI.openTab('report')"><i class="fas fa-file-alt"></i> Report</button>
            </div>
        </div>

        <div id="messageContainer"></div>

        <div id="dashboard" class="tab-content" style="display: block;">
            <div class="dashboard-stats">
                <div class="stat-card">
                    <i class="fas fa-wallet"></i>
                    <h3>Total Sales</h3>
                    <p id="totalSales">RM 0</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-shopping-cart"></i>
                    <h3>Transaction Count</h3>
                    <p id="transactionCount">0</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-chart-bar"></i>
                    <h3>Average Sale</h3>
                    <p id="averageSale">RM 0</p>
                </div>
            </div>
            <div class="table-container">
                <table id="salesTable">
                    <thead>
                        <tr>
                            <th><i class="fas fa-calendar"></i> Date</th>
                            <th><i class="fas fa-money-bill"></i> Total</th>
                        </tr>
                    </thead>
                    <tbody id="salesBody"></tbody>
                </table>
            </div>
        </div>

        <div id="sales" class="tab-content">
            <div class="form-container">
                <h2><i class="fas fa-money-bill-wave"></i> Sales Entry</h2>
                <button class="nav-item" onclick="UI.showSubMenu('salesSub')"><i class="fas fa-shopping-bag"></i> Sales</button>
                <button class="nav-item" onclick="UI.showSubMenu('serviceAdvisor')"><i class="fas fa-user-tie"></i> Service Advisor</button>
                <button class="nav-item" onclick="UI.showSubMenu('serviceTech')"><i class="fas fa-tools"></i> Service Technician</button>

                <div id="subMenu" style="display: none;">
                    <div id="salesSub" class="sub-menu" style="display: none;">
                        <h3><i class="fas fa-shopping-bag"></i> Sales Categories</h3>
                        <form id="salesSubForm" class="centered-form">
                            <div class="input-group">
                                <label for="intake">Intake (Unit):</label>
                                <i class="fas fa-box"></i>
                                <input type="number" id="intake" min="0" step="1">
                            </div>
                            <div class="input-group">
                                <label for="labour">Labour (RM):</label>
                                <i class="fas fa-hammer"></i>
                                <input type="number" id="labour" min="0" step="0.01">
                            </div>
                            <div class="input-group">
                                <label for="part">Parts (RM):</label>
                                <i class="fas fa-cogs"></i>
                                <input type="number" id="part" min="0" step="0.01">
                            </div>
                            <div class="input-group">
                                <label for="accessories">Accessories (RM):</label>
                                <i class="fas fa-plus-circle"></i>
                                <input type="number" id="accessories" min="0" step="0.01">
                            </div>
                            <div class="input-group">
                                <label for="gearUp">Gear Up (RM):</label>
                                <i class="fas fa-tools"></i>
                                <input type="number" id="gearUp" min="0" step="0.01">
                            </div>
                            <div class="input-group">
                                <label for="material">Material (RM):</label>
                                <i class="fas fa-boxes"></i>
                                <input type="number" id="material" min="0" step="0.01">
                            </div>
                            <div class="input-group">
                                <label for="lubricant">Lubricant (RM):</label>
                                <i class="fas fa-oil-can"></i>
                                <input type="number" id="lubricant" min="0" step="0.01">
                            </div>
                            <div class="input-group">
                                <label>Total:</label>
                                <i class="fas fa-calculator"></i>
                                <span id="salesTotal">RM 0</span>
                            </div>
                        </form>
                    </div>

                    <div id="serviceAdvisor" class="sub-menu" style="display: none;">
                        <h3><i class="fas fa-user-tie"></i> Service Advisor Categories</h3>
                        <form id="advisorForm" class="centered-form">
                            <div class="input-group">
                                <label for="advisorSelect">Service Advisor:</label>
                                <i class="fas fa-user"></i>
                                <select id="advisorSelect">
                                    <option value="">Select Advisor</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label for="advisorIntake">Intake (Unit):</label>
                                <i class="fas fa-box"></i>
                                <input type="number" id="advisorIntake" min="0" step="1">
                            </div>
                            <div class="input-group">
                                <label for="advisorLabour">Labour (RM):</label>
                                <i class="fas fa-hammer"></i>
                                <input type="number" id="advisorLabour" min="0" step="0.01">
                            </div>
                            <div class="input-group">
                                <label for="advisorPart">Parts (RM):</label>
                                <i class="fas fa-cogs"></i>
                                <input type="number" id="advisorPart" min="0" step="0.01">
                            </div>
                            <div class="input-group">
                                <label for="advisorAccessories">Accessories (RM):</label>
                                <i class="fas fa-plus-circle"></i>
                                <input type="number" id="advisorAccessories" min="0" step="0.01">
                            </div>
                            <div class="input-group">
                                <label for="advisorGearUp">Gear Up (RM):</label>
                                <i class="fas fa-tools"></i>
                                <input type="number" id="advisorGearUp" min="0" step="0.01">
                            </div>
                            <div class="input-group">
                                <label for="advisorMaterial">Material (RM):</label>
                                <i class="fas fa-boxes"></i>
                                <input type="number" id="advisorMaterial" min="0" step="0.01">
                            </div>
                            <div class="input-group">
                                <label for="advisorLubricant">Lubricant (RM):</label>
                                <i class="fas fa-oil-can"></i>
                                <input type="number" id="advisorLubricant" min="0" step="0.01">
                            </div>
                            <div class="input-group">
                                <label>Total:</label>
                                <i class="fas fa-calculator"></i>
                                <span id="advisorTotal">RM 0</span>
                            </div>
                        </form>
                    </div>

                    <div id="serviceTech" class="sub-menu" style="display: none;">
                        <h3><i class="fas fa-tools"></i> Service Technician Categories</h3>
                        <form id="techForm" class="centered-form">
                            <div class="input-group">
                                <label for="techSelect">Service Technician:</label>
                                <i class="fas fa-user"></i>
                                <select id="techSelect">
                                    <option value="">Select Technician</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label for="techIntake">Intake (Unit):</label>
                                <i class="fas fa-box"></i>
                                <input type="number" id="techIntake" min="0" step="1">
                            </div>
                            <div class="input-group">
                                <label for="techLabour">Labour (RM):</label>
                                <i class="fas fa-hammer"></i>
                                <input type="number" id="techLabour" min="0" step="0.01">
                            </div>
                            <div class="input-group">
                                <label for="techPart">Parts (RM):</label>
                                <i class="fas fa-cogs"></i>
                                <input type="number" id="techPart" min="0" step="0.01">
                            </div>
                            <div class="input-group">
                                <label for="techSecondItem">Second Item (RM):</label>
                                <i class="fas fa-tools"></i>
                                <input type="number" id="techSecondItem" min="0" step="0.01">
                            </div>
                            <div class="input-group">
                                <label>Total:</label>
                                <i class="fas fa-calculator"></i>
                                <span id="techTotal">RM 0</span>
                            </div>
                        </form>
                    </div>
                </div>

                <form id="salesForm">
                    <div class="input-group">
                        <label for="date">Date:</label>
                        <i class="fas fa-calendar-alt"></i>
                        <input type="date" id="date" required>
                    </div>
                    <div class="input-group">
                        <button type="submit" class="button btn-primary"><i class="fas fa-plus"></i> Add Data</button>
                        <button type="button" id="saveAndAdd" class="button btn-primary"><i class="fas fa-save"></i> Save & Add Another</button>
                        <button type="button" id="clearAll" class="button btn-danger"><i class="fas fa-trash-alt"></i> Delete All</button>
                    </div>
                </form>

                <div class="table-container" id="dailySalesContainer" style="display: none;">
                    <h3><i class="fas fa-list"></i> Today's Entries</h3>
                    <table id="dailySalesTable">
                        <thead>
                            <tr>
                                <th><i class="fas fa-clock"></i> Time</th>
                                <th><i class="fas fa-money-bill"></i> Total</th>
                                <th><i class="fas fa-user-tie"></i> Advisor</th>
                                <th><i class="fas fa-tools"></i> Technician</th>
                            </tr>
                        </thead>
                        <tbody id="dailySalesBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="staff" class="tab-content">
            <div class="form-container">
                <h2><i class="fas fa-users"></i> Staff Setup</h2>
                <form id="staffForm">
                    <div class="input-group">
                        <label for="staffName">Staff Name:</label>
                        <i class="fas fa-user"></i>
                        <input type="text" id="staffName" required>
                    </div>
                    <div class="input-group">
                        <label for="staffRole">Role:</label>
                        <i class="fas fa-briefcase"></i>
                        <select id="staffRole" required>
                            <option value="">Select Role</option>
                            <option value="advisor">Service Advisor</option>
                            <option value="technician">Service Technician</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <button type="submit" class="button btn-primary"><i class="fas fa-plus"></i> Add Staff</button>
                    </div>
                </form>
                <div class="table-container">
                    <table id="staffTable">
                        <thead>
                            <tr>
                                <th><i class="fas fa-user"></i> Name</th>
                                <th><i class="fas fa-briefcase"></i> Role</th>
                                <th><i class="fas fa-cogs"></i> Actions</th>
                            </tr>
                        </thead>
                        <tbody id="staffBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="partStore" class="tab-content">
            <div class="form-container">
                <h2><i class="fas fa-warehouse"></i> Part Store</h2>
                <button class="nav-item" onclick="UI.showPartSubMenu('partPurchase')"><i class="fas fa-shopping-cart"></i> Part Purchase</button>
                <button class="nav-item" onclick="UI.showPartSubMenu('partPurchaseTarget')"><i class="fas fa-bullseye"></i> Purchase Target</button>
                <button class="nav-item" onclick="UI.showPartSubMenu('remainingTarget')"><i class="fas fa-balance-scale"></i> Remaining Target</button>
                <button class="nav-item" onclick="UI.showPartSubMenu('totalOrdering')"><i class="fas fa-truck"></i> Total Ordering</button>

                <div id="partSubMenu" style="display: none;">
                    <div id="partPurchase" class="sub-menu" style="display: none;">
                        <h3><i class="fas fa-shopping-cart"></i> Part Purchase</h3>
                        <form id="purchaseForm">
                            <div class="input-group">
                                <label for="purchasePart">Parts (RM):</label>
                                <i class="fas fa-cogs"></i>
                                <input type="number" id="purchasePart" min="0" step="0.01">
                            </div>
                            <div class="input-group">
                                <label for="purchaseGearUp">Gear Up (RM):</label>
                                <i class="fas fa-tools"></i>
                                <input type="number" id="purchaseGearUp" min="0" step="0.01">
                            </div>
                            <div class="input-group">
                                <label for="purchaseAccessories">Accessories (RM):</label>
                                <i class="fas fa-plus-circle"></i>
                                <input type="number" id="purchaseAccessories" min="0" step="0.01">
                            </div>
                            <div class="input-group">
                                <label>Total:</label>
                                <i class="fas fa-calculator"></i>
                                <span id="purchaseTotal">RM 0</span>
                            </div>
                        </form>
                    </div>

                    <div id="partPurchaseTarget" class="sub-menu" style="display: none;">
                        <h3><i class="fas fa-bullseye"></i> Purchase Target</h3>
                        <form id="targetPurchaseForm">
                            <div class="input-group">
                                <label for="targetPart">Parts (RM):</label>
                                <i class="fas fa-cogs"></i>
                                <input type="number" id="targetPart" min="0" step="0.01">
                            </div>
                            <div class="input-group">
                                <label for="targetGearUp">Gear Up (RM):</label>
                                <i class="fas fa-tools"></i>
                                <input type="number" id="targetGearUp" min="0" step="0.01">
                            </div>
                            <div class="input-group">
                                <label for="targetAccessories">Accessories (RM):</label>
                                <i class="fas fa-plus-circle"></i>
                                <input type="number" id="targetAccessories" min="0" step="0.01">
                            </div>
                            <div class="input-group">
                                <label>Total:</label>
                                <i class="fas fa-calculator"></i>
                                <span id="targetTotal">RM 0</span>
                            </div>
                        </form>
                    </div>

                    <div id="remainingTarget" class="sub-menu" style="display: none;">
                        <h3><i class="fas fa-balance-scale"></i> Remaining Target</h3>
                        <form id="remainingForm">
                            <div class="input-group">
                                <label for="remainingPart">Parts (RM):</label>
                                <i class="fas fa-cogs"></i>
                                <input type="number" id="remainingPart" readonly>
                            </div>
                            <div class="input-group">
                                <label for="remainingGearUp">Gear Up (RM):</label>
                                <i class="fas fa-tools"></i>
                                <input type="number" id="remainingGearUp" readonly>
                            </div>
                            <div class="input-group">
                                <label for="remainingAccessories">Accessories (RM):</label>
                                <i class="fas fa-plus-circle"></i>
                                <input type="number" id="remainingAccessories" readonly>
                            </div>
                            <div class="input-group">
                                <label>Total:</label>
                                <i class="fas fa-calculator"></i>
                                <span id="remainingTotal">RM 0</span>
                            </div>
                        </form>
                    </div>

                    <div id="totalOrdering" class="sub-menu" style="display: none;">
                        <h3><i class="fas fa-truck"></i> Total Ordering</h3>
                        <form id="orderingForm">
                            <div class="input-group">
                                <label for="orderingPart">Parts (RM):</label>
                                <i class="fas fa-cogs"></i>
                                <input type="number" id="orderingPart" min="0" step="0.01">
                            </div>
                            <div class="input-group">
                                <label for="orderingGearUp">Gear Up (RM):</label>
                                <i class="fas fa-tools"></i>
                                <input type="number" id="orderingGearUp" min="0" step="0.01">
                            </div>
                            <div class="input-group">
                                <label>Total:</label>
                                <i class="fas fa-calculator"></i>
                                <span id="orderingTotal">RM 0</span>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div id="report" class="tab-content">
            <div class="form-container">
                <h2><i class="fas fa-file-alt"></i> Reporting</h2>
                <button class="nav-item" onclick="UI.showReportSubMenu('salesReport')"><i class="fas fa-chart-bar"></i> Sales Report</button>
                <button class="nav-item" onclick="UI.showReportSubMenu('advisorReport')"><i class="fas fa-user-tie"></i> Advisor Report</button>
                <button class="nav-item" onclick="UI.showReportSubMenu('techReport')"><i class="fas fa-tools"></i> Technician Report</button>

                <div id="reportSubMenu" style="display: none;">
                    <div id="salesReport" class="sub-menu" style="display: none;">
                        <h3><i class="fas fa-chart-bar"></i> Sales Report</h3>
                        <div class="input-group">
                            <label>Date Range:</label>
                            <i class="fas fa-calendar"></i>
                            <input type="date" id="salesReportStart">
                            <input type="date" id="salesReportEnd">
                        </div>
                        <canvas id="salesChart" style="max-height: 400px;"></canvas>
                        <button class="button btn-primary" onclick="UI.generateSalesReport()"><i class="fas fa-download"></i> Generate PDF</button>
                    </div>

                    <div id="advisorReport" class="sub-menu" style="display: none;">
                        <h3><i class="fas fa-user-tie"></i> Service Advisor Report</h3>
                        <div class="input-group">
                            <label for="advisorReportSelect">Service Advisor:</label>
                            <i class="fas fa-user"></i>
                            <select id="advisorReportSelect">
                                <option value="">Select Advisor</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Date Range:</label>
                            <i class="fas fa-calendar"></i>
                            <input type="date" id="advisorReportStart">
                            <input type="date" id="advisorReportEnd">
                        </div>
                        <canvas id="advisorChart" style="max-height: 400px;"></canvas>
                        <button class="button btn-primary" onclick="UI.generateAdvisorReport()"><i class="fas fa-download"></i> Generate PDF</button>
                    </div>

                    <div id="techReport" class="sub-menu" style="display: none;">
                        <h3><i class="fas fa-tools"></i> Service Technician Report</h3>
                        <div class="input-group">
                            <label for="techReportSelect">Service Technician:</label>
                            <i class="fas fa-user"></i>
                            <select id="techReportSelect">
                                <option value="">Select Technician</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Date Range:</label>
                            <i class="fas fa-calendar"></i>
                            <input type="date" id="techReportStart">
                            <input type="date" id="techReportEnd">
                        </div>
                        <canvas id="techChart" style="max-height: 400px;"></canvas>
                        <button class="button btn-primary" onclick="UI.generateTechReport()"><i class="fas fa-download"></i> Generate PDF</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let salesData = [];
        let staffData = [];
        let salesChart, advisorChart, techChart;

        const UI = {
            elements: {
                form: document.getElementById('salesForm'),
                staffForm: document.getElementById('staffForm'),
                tableBody: document.getElementById('salesBody'),
                staffTableBody: document.getElementById('staffBody'),
                messageContainer: document.getElementById('messageContainer'),
                clearAllBtn: document.getElementById('clearAll'),
                date: document.getElementById('date'),
                totalSales: document.getElementById('totalSales'),
                transactionCount: document.getElementById('transactionCount'),
                averageSale: document.getElementById('averageSale'),
                hamburger: document.querySelector('.hamburger'),
                navMenu: document.querySelector('.nav-menu'),
                subMenu: document.getElementById('subMenu'),
                targetSubMenu: document.getElementById('targetSubMenu'),
                partSubMenu: document.getElementById('partSubMenu'),
                reportSubMenu: document.getElementById('reportSubMenu'),
                salesSub: document.getElementById('salesSub'),
                serviceAdvisor: document.getElementById('serviceAdvisor'),
                serviceTech: document.getElementById('serviceTech'),
                syarikat: document.getElementById('syarikat'),
                peroduaHQ: document.getElementById('peroduaHQ'),
                targetServiceAdvisor: document.getElementById('targetServiceAdvisor'),
                targetServiceTech: document.getElementById('targetServiceTech'),
                afterWarranty: document.getElementById('afterWarranty'),
                partPurchase: document.getElementById('partPurchase'),
                partPurchaseTarget: document.getElementById('partPurchaseTarget'),
                remainingTarget: document.getElementById('remainingTarget'),
                totalOrdering: document.getElementById('totalOrdering'),
                salesReport: document.getElementById('salesReport'),
                advisorReport: document.getElementById('advisorReport'),
                techReport: document.getElementById('techReport'),
                advisorSelect: document.getElementById('advisorSelect'),
                techSelect: document.getElementById('techSelect'),
                salesInputs: {
                    intake: document.getElementById('intake'),
                    labour: document.getElementById('labour'),
                    part: document.getElementById('part'),
                    accessories: document.getElementById('accessories'),
                    gearUp: document.getElementById('gearUp'),
                    material: document.getElementById('material'),
                    lubricant: document.getElementById('lubricant'),
                    total: document.getElementById('salesTotal')
                },
                advisorInputs: {
                    intake: document.getElementById('advisorIntake'),
                    labour: document.getElementById('advisorLabour'),
                    part: document.getElementById('advisorPart'),
                    accessories: document.getElementById('advisorAccessories'),
                    gearUp: document.getElementById('advisorGearUp'),
                    material: document.getElementById('advisorMaterial'),
                    lubricant: document.getElementById('advisorLubricant'),
                    total: document.getElementById('advisorTotal')
                },
                techInputs: {
                    intake: document.getElementById('techIntake'),
                    labour: document.getElementById('techLabour'),
                    part: document.getElementById('techPart'),
                    secondItem: document.getElementById('techSecondItem'),
                    total: document.getElementById('techTotal')
                },
                syarikatInputs: {
                    intake: document.getElementById('syarikatIntake'),
                    labour: document.getElementById('syarikatLabour'),
                    part: document.getElementById('syarikatPart'),
                    total: document.getElementById('syarikatTotal')
                },
                peroduaHQInputs: {
                    intake: document.getElementById('peroduaHQIntake'),
                    labour: document.getElementById('peroduaHQLabour'),
                    part: document.getElementById('peroduaHQPart'),
                    total: document.getElementById('peroduaHQTotal')
                },
                targetAdvisorInputs: {
                    intake: document.getElementById('targetAdvisorIntake'),
                    labour: document.getElementById('targetAdvisorLabour'),
                    total: document.getElementById('targetAdvisorTotal')
                },
                targetTechInputs: {
                    intake: document.getElementById('targetTechIntake'),
                    labour: document.getElementById('targetTechLabour'),
                    total: document.getElementById('targetTechTotal')
                },
                afterWarrantyInputs: {
                    intake: document.getElementById('afterWarrantyIntake')
                },
                purchaseInputs: {
                    part: document.getElementById('purchasePart'),
                    gearUp: document.getElementById('purchaseGearUp'),
                    accessories: document.getElementById('purchaseAccessories'),
                    total: document.getElementById('purchaseTotal')
                },
                targetPurchaseInputs: {
                    part: document.getElementById('targetPart'),
                    gearUp: document.getElementById('targetGearUp'),
                    accessories: document.getElementById('targetAccessories'),
                    total: document.getElementById('targetTotal')
                },
                remainingInputs: {
                    part: document.getElementById('remainingPart'),
                    gearUp: document.getElementById('remainingGearUp'),
                    accessories: document.getElementById('remainingAccessories'),
                    total: document.getElementById('remainingTotal')
                },
                orderingInputs: {
                    part: document.getElementById('orderingPart'),
                    gearUp: document.getElementById('orderingGearUp'),
                    total: document.getElementById('orderingTotal')
                },
                salesReportInputs: {
                    start: document.getElementById('salesReportStart'),
                    end: document.getElementById('salesReportEnd'),
                    chart: document.getElementById('salesChart')
                },
                advisorReportInputs: {
                    select: document.getElementById('advisorReportSelect'),
                    start: document.getElementById('advisorReportStart'),
                    end: document.getElementById('advisorReportEnd'),
                    chart: document.getElementById('advisorChart')
                },
                techReportInputs: {
                    select: document.getElementById('techReportSelect'),
                    start: document.getElementById('techReportStart'),
                    end: document.getElementById('techReportEnd'),
                    chart: document.getElementById('techChart')
                }
            },

            init: function() {
                this.setDefaultDate();
                this.setDefaultReportDates();
                this.setupEventListeners();
                this.renderSalesTable();
                this.renderStaffTable();
                this.renderDailySales();
                this.updateDashboard();
                this.updateStaffSelects();
            },

            setDefaultDate: function() {
                this.elements.date.value = new Date().toISOString().split('T')[0];
            },

            setDefaultReportDates: function() {
                const today = new Date().toISOString().split('T')[0];
                this.elements.salesReportInputs.start.value = today;
                this.elements.salesReportInputs.end.value = today;
                this.elements.advisorReportInputs.start.value = today;
                this.elements.advisorReportInputs.end.value = today;
                this.elements.techReportInputs.start.value = today;
                this.elements.techReportInputs.end.value = today;
            },

            formatDate: function(dateString) {
                const date = new Date(dateString);
                return date.toLocaleDateString('en-US', {
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric'
                });
            },

            formatCurrency: function(amount) {
                return 'RM ' + parseFloat(amount).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            },

            showMessage: function(message, type = 'success') {
                this.elements.messageContainer.innerHTML = `
                    <div class="message ${type}">
                        <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                        ${message}
                    </div>
                `;
                setTimeout(() => {
                    this.elements.messageContainer.innerHTML = '';
                }, 3000);
            },

            renderSalesTable: function() {
                this.elements.tableBody.innerHTML = '';
                salesData.forEach(data => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${this.formatDate(data.date)}</td>
                        <td>${this.formatCurrency(data.total)}</td>
                    `;
                    this.elements.tableBody.appendChild(row);
                });
            },

            renderDailySales: function() {
                const today = this.elements.date.value;
                const todayData = salesData.filter(data => data.date === today);
                const tbody = document.getElementById('dailySalesBody');
                tbody.innerHTML = '';
                if (todayData.length > 0) {
                    document.getElementById('dailySalesContainer').style.display = 'block';
                    todayData.forEach(data => {
                        const row = document.createElement('tr');
                        const time = new Date().toLocaleTimeString('en-US', { hour12: false });
                        row.innerHTML = `
                            <td>${time}</td>
                            <td>${this.formatCurrency(data.total)}</td>
                            <td>${data.advisor || '-'}</td>
                            <td>${data.technician || '-'}</td>
                        `;
                        tbody.appendChild(row);
                    });
                } else {
                    document.getElementById('dailySalesContainer').style.display = 'none';
                }
            },

            renderStaffTable: function() {
                this.elements.staffTableBody.innerHTML = '';
                staffData.forEach((staff, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${staff.name}</td>
                        <td>${staff.role === 'advisor' ? 'Service Advisor' : 'Service Technician'}</td>
                        <td>
                            <button class="button btn-primary" onclick="UI.editStaff(${index})"><i class="fas fa-edit"></i> Edit</button>
                            <button class="button btn-danger" onclick="UI.deleteStaff(${index})"><i class="fas fa-trash"></i> Delete</button>
                        </td>
                    `;
                    this.elements.staffTableBody.appendChild(row);
                });
                this.updateStaffSelects();
            },

            updateStaffSelects: function() {
                const advisors = staffData.filter(staff => staff.role === 'advisor');
                const technicians = staffData.filter(staff => staff.role === 'technician');
                const recentAdvisor = salesData[salesData.length - 1]?.advisor;
                const recentTech = salesData[salesData.length - 1]?.technician;

                this.elements.advisorSelect.innerHTML = '<option value="">Select Advisor</option>';
                this.elements.advisorReportInputs.select.innerHTML = '<option value="">Select Advisor</option>';
                advisors.forEach(advisor => {
                    const option = document.createElement('option');
                    option.value = advisor.name;
                    option.textContent = advisor.name;
                    if (advisor.name === recentAdvisor) option.selected = true;
                    this.elements.advisorSelect.appendChild(option.cloneNode(true));
                    this.elements.advisorReportInputs.select.appendChild(option);
                });

                this.elements.techSelect.innerHTML = '<option value="">Select Technician</option>';
                this.elements.techReportInputs.select.innerHTML = '<option value="">Select Technician</option>';
                technicians.forEach(tech => {
                    const option = document.createElement('option');
                    option.value = tech.name;
                    option.textContent = tech.name;
                    if (tech.name === recentTech) option.selected = true;
                    this.elements.techSelect.appendChild(option.cloneNode(true));
                    this.elements.techReportInputs.select.appendChild(option);
                });
            },

            updateDashboard: function() {
                const total = salesData.reduce((sum, data) => sum + data.total, 0);
                const count = salesData.length;
                const average = count > 0 ? total / count : 0;

                this.elements.totalSales.textContent = this.formatCurrency(total);
                this.elements.transactionCount.textContent = count;
                this.elements.averageSale.textContent = this.formatCurrency(average);
            },

            clearSalesForm: function() {
                this.elements.form.reset();
                this.elements.salesInputs.intake.value = '';
                this.elements.salesInputs.labour.value = '';
                this.elements.salesInputs.part.value = '';
                this.elements.salesInputs.accessories.value = '';
                this.elements.salesInputs.gearUp.value = '';
                this.elements.salesInputs.material.value = '';
                this.elements.salesInputs.lubricant.value = '';
                this.elements.advisorInputs.intake.value = '';
                this.elements.advisorInputs.labour.value = '';
                this.elements.advisorInputs.part.value = '';
                this.elements.advisorInputs.accessories.value = '';
                this.elements.advisorInputs.gearUp.value = '';
                this.elements.advisorInputs.material.value = '';
                this.elements.advisorInputs.lubricant.value = '';
                this.elements.techInputs.intake.value = '';
                this.elements.techInputs.labour.value = '';
                this.elements.techInputs.part.value = '';
                this.elements.techInputs.secondItem.value = '';
                this.elements.advisorSelect.value = '';
                this.elements.techSelect.value = '';
                this.updateSalesTotal();
                this.updateAdvisorTotal();
                this.updateTechTotal();
                this.setDefaultDate();
            },

            clearStaffForm: function() {
                this.elements.staffForm.reset();
            },

            setupEventListeners: function() {
                this.elements.form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleSalesFormSubmit(true);
                });

                document.getElementById('saveAndAdd').addEventListener('click', () => {
                    this.handleSalesFormSubmit(false);
                });

                this.elements.staffForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleStaffFormSubmit();
                });

                this.elements.clearAllBtn.addEventListener('click', () => {
                    this.handleClearAll();
                });

                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey && e.key === 's') {
                        e.preventDefault();
                        this.handleSalesFormSubmit(false);
                    } else if (e.key === 'Enter' && document.activeElement.tagName === 'INPUT') {
                        e.preventDefault();
                        this.handleSalesFormSubmit(true);
                    }
                });

                this.setupInputListeners(this.elements.salesInputs, this.updateSalesTotal);
                this.setupInputListeners(this.elements.advisorInputs, this.updateAdvisorTotal);
                this.setupInputListeners(this.elements.techInputs, this.updateTechTotal);
                this.setupInputListeners(this.elements.syarikatInputs, this.updateSyarikatTotal);
                this.setupInputListeners(this.elements.peroduaHQInputs, this.updatePeroduaHQTotal);
                this.setupInputListeners(this.elements.targetAdvisorInputs, this.updateTargetAdvisorTotal);
                this.setupInputListeners(this.elements.targetTechInputs, this.updateTargetTechTotal);
                this.setupInputListeners(this.elements.purchaseInputs, () => {
                    this.updatePurchaseTotal();
                    this.updateRemainingTarget();
                });
                this.setupInputListeners(this.elements.targetPurchaseInputs, () => {
                    this.updateTargetPurchaseTotal();
                    this.updateRemainingTarget();
                });
                this.setupInputListeners(this.elements.orderingInputs, this.updateOrderingTotal);

                this.elements.salesReportInputs.start.addEventListener('change', () => this.generateSalesChart());
                this.elements.salesReportInputs.end.addEventListener('change', () => this.generateSalesChart());
                this.elements.advisorReportInputs.select.addEventListener('change', () => this.generateAdvisorChart());
                this.elements.advisorReportInputs.start.addEventListener('change', () => this.generateAdvisorChart());
                this.elements.advisorReportInputs.end.addEventListener('change', () => this.generateAdvisorChart());
                this.elements.techReportInputs.select.addEventListener('change', () => this.generateTechChart());
                this.elements.techReportInputs.start.addEventListener('change', () => this.generateTechChart());
                this.elements.techReportInputs.end.addEventListener('change', () => this.generateTechChart());
            },

            setupInputListeners: function(inputs, callback) {
                Object.values(inputs).forEach(input => {
                    if (input && input.tagName === 'INPUT') {
                        input.addEventListener('input', callback.bind(this));
                    }
                });
            },

            updateSalesTotal: function() {
                const labour = parseFloat(this.elements.salesInputs.labour.value) || 0;
                const part = parseFloat(this.elements.salesInputs.part.value) || 0;
                const accessories = parseFloat(this.elements.salesInputs.accessories.value) || 0;
                const gearUp = parseFloat(this.elements.salesInputs.gearUp.value) || 0;
                const material = parseFloat(this.elements.salesInputs.material.value) || 0;
                const lubricant = parseFloat(this.elements.salesInputs.lubricant.value) || 0;
                const total = labour + part + accessories + gearUp + material + lubricant;
                this.elements.salesInputs.total.textContent = this.formatCurrency(total);
                return total;
            },

            updateAdvisorTotal: function() {
                const labour = parseFloat(this.elements.advisorInputs.labour.value) || 0;
                const part = parseFloat(this.elements.advisorInputs.part.value) || 0;
                const accessories = parseFloat(this.elements.advisorInputs.accessories.value) || 0;
                const gearUp = parseFloat(this.elements.advisorInputs.gearUp.value) || 0;
                const material = parseFloat(this.elements.advisorInputs.material.value) || 0;
                const lubricant = parseFloat(this.elements.advisorInputs.lubricant.value) || 0;
                const total = labour + part + accessories + gearUp + material + lubricant;
                this.elements.advisorInputs.total.textContent = this.formatCurrency(total);
                return total;
            },

            updateTechTotal: function() {
                const labour = parseFloat(this.elements.techInputs.labour.value) || 0;
                const part = parseFloat(this.elements.techInputs.part.value) || 0;
                const secondItem = parseFloat(this.elements.techInputs.secondItem.value) || 0;
                const total = labour + part + secondItem;
                this.elements.techInputs.total.textContent = this.formatCurrency(total);
                return total;
            },

            updateSyarikatTotal: function() {
                const labour = parseFloat(this.elements.syarikatInputs.labour.value) || 0;
                const part = parseFloat(this.elements.syarikatInputs.part.value) || 0;
                const total = labour + part;
                this.elements.syarikatInputs.total.textContent = this.formatCurrency(total);
                return total;
            },

            updatePeroduaHQTotal: function() {
                const labour = parseFloat(this.elements.peroduaHQInputs.labour.value) || 0;
                const part = parseFloat(this.elements.peroduaHQInputs.part.value) || 0;
                const total = labour + part;
                this.elements.peroduaHQInputs.total.textContent = this.formatCurrency(total);
                return total;
            },

            updateTargetAdvisorTotal: function() {
                const labour = parseFloat(this.elements.targetAdvisorInputs.labour.value) || 0;
                const total = labour;
                this.elements.targetAdvisorInputs.total.textContent = this.formatCurrency(total);
                return total;
            },

            updateTargetTechTotal: function() {
                const labour = parseFloat(this.elements.targetTechInputs.labour.value) || 0;
                const total = labour;
                this.elements.targetTechInputs.total.textContent = this.formatCurrency(total);
                return total;
            },

            updatePurchaseTotal: function() {
                const part = parseFloat(this.elements.purchaseInputs.part.value) || 0;
                const gearUp = parseFloat(this.elements.purchaseInputs.gearUp.value) || 0;
                const accessories = parseFloat(this.elements.purchaseInputs.accessories.value) || 0;
                const total = part + gearUp + accessories;
                this.elements.purchaseInputs.total.textContent = this.formatCurrency(total);
                return total;
            },

            updateTargetPurchaseTotal: function() {
                const part = parseFloat(this.elements.targetPurchaseInputs.part.value) || 0;
                const gearUp = parseFloat(this.elements.targetPurchaseInputs.gearUp.value) || 0;
                const accessories = parseFloat(this.elements.targetPurchaseInputs.accessories.value) || 0;
                const total = part + gearUp + accessories;
                this.elements.targetPurchaseInputs.total.textContent = this.formatCurrency(total);
                return total;
            },

            updateRemainingTarget: function() {
                const targetPart = parseFloat(this.elements.targetPurchaseInputs.part.value) || 0;
                const targetGearUp = parseFloat(this.elements.targetPurchaseInputs.gearUp.value) || 0;
                const targetAccessories = parseFloat(this.elements.targetPurchaseInputs.accessories.value) || 0;

                const purchasePart = parseFloat(this.elements.purchaseInputs.part.value) || 0;
                const purchaseGearUp = parseFloat(this.elements.purchaseInputs.gearUp.value) || 0;
                const purchaseAccessories = parseFloat(this.elements.purchaseInputs.accessories.value) || 0;

                const remainingPart = targetPart - purchasePart;
                const remainingGearUp = targetGearUp - purchaseGearUp;
                const remainingAccessories = targetAccessories - purchaseAccessories;
                const remainingTotal = remainingPart + remainingGearUp + remainingAccessories;

                this.elements.remainingInputs.part.value = remainingPart.toFixed(2);
                this.elements.remainingInputs.gearUp.value = remainingGearUp.toFixed(2);
                this.elements.remainingInputs.accessories.value = remainingAccessories.toFixed(2);
                this.elements.remainingInputs.total.textContent = this.formatCurrency(remainingTotal);
            },

            updateOrderingTotal: function() {
                const part = parseFloat(this.elements.orderingInputs.part.value) || 0;
                const gearUp = parseFloat(this.elements.orderingInputs.gearUp.value) || 0;
                const total = part + gearUp;
                this.elements.orderingInputs.total.textContent = this.formatCurrency(total);
                return total;
            },

            handleSalesFormSubmit: function(returnToDashboard = true) {
                const date = this.elements.date.value;
                if (!date) {
                    this.showMessage('Please fill the date field correctly!', 'error');
                    return;
                }

                const salesTotal = this.updateSalesTotal();
                const advisorTotal = this.updateAdvisorTotal();
                const techTotal = this.updateTechTotal();
                const total = salesTotal + advisorTotal + techTotal;
                const advisor = this.elements.advisorSelect.value;
                const technician = this.elements.techSelect.value;

                const newData = { 
                    date, 
                    total,
                    advisor: advisor || undefined,
                    technician: technician || undefined
                };
                salesData.push(newData);
                this.renderSalesTable();
                this.renderDailySales();
                this.updateDashboard();
                this.showMessage('Data added successfully!');

                if (returnToDashboard) {
                    this.clearSalesForm();
                    this.toggleMenu(false);
                    this.openTab('dashboard');
                } else {
                    this.clearSalesForm();
                }
            },

            handleStaffFormSubmit: function() {
                const name = document.getElementById('staffName').value;
                const role = document.getElementById('staffRole').value;
                
                if (!name || !role) {
                    this.showMessage('Please fill all staff fields!', 'error');
                    return;
                }

                const existingStaff = staffData.find(staff => staff.name === name);
                if (existingStaff) {
                    existingStaff.role = role;
                    this.showMessage('Staff updated successfully!');
                } else {
                    staffData.push({ name, role });
                    this.showMessage('Staff added successfully!');
                }
                
                this.clearStaffForm();
                this.renderStaffTable();
            },

            editStaff: function(index) {
                const staff = staffData[index];
                document.getElementById('staffName').value = staff.name;
                document.getElementById('staffRole').value = staff.role;
                staffData.splice(index, 1);
                this.renderStaffTable();
            },

            deleteStaff: function(index) {
                if (confirm('Are you sure you want to delete this staff member?')) {
                    staffData.splice(index, 1);
                    this.renderStaffTable();
                    this.showMessage('Staff deleted successfully!');
                }
            },

            handleClearAll: function() {
                if (salesData.length === 0) {
                    this.showMessage('No data to delete!', 'error');
                    return;
                }
                if (confirm('Are you sure you want to delete all sales data?')) {
                    salesData = [];
                    this.renderSalesTable();
                    this.renderDailySales();
                    this.updateDashboard();
                    this.showMessage('All sales data has been deleted!');
                }
            },

            openTab: function(tabName) {
                const tabContents = document.getElementsByClassName('tab-content');
                const navItems = document.getElementsByClassName('nav-item');

                for (let content of tabContents) {
                    content.style.display = 'none';
                }
                for (let item of navItems) {
                    item.classList.remove('active');
                }

                document.getElementById(tabName).style.display = 'block';
                const selectedItem = Array.from(navItems).find(item => item.onclick.toString().includes(tabName));
                if (selectedItem) selectedItem.classList.add('active');
                this.toggleMenu(false);
                if (tabName === 'sales') this.renderDailySales();
            },

            toggleMenu: function(forceClose = null) {
                const isOpen = this.elements.navMenu.classList.contains('open');
                if (forceClose === false || (forceClose === null && isOpen)) {
                    this.elements.navMenu.classList.remove('open');
                    this.elements.hamburger.classList.remove('open');
                } else {
                    this.elements.navMenu.classList.add('open');
                    this.elements.hamburger.classList.add('open');
                }
            },

            showSubMenu: function(type) {
                const salesSubMenu = this.elements.salesSub;
                const advisorSubMenu = this.elements.serviceAdvisor;
                const techSubMenu = this.elements.serviceTech;

                salesSubMenu.style.display = 'none';
                advisorSubMenu.style.display = 'none';
                techSubMenu.style.display = 'none';

                if (type === 'salesSub') {
                    salesSubMenu.style.display = 'block';
                } else if (type === 'serviceAdvisor') {
                    advisorSubMenu.style.display = 'block';
                } else if (type === 'serviceTech') {
                    techSubMenu.style.display = 'block';
                }
                
                this.elements.subMenu.style.display = 'block';
                this.setDefaultDate();
            },

            showTargetSubMenu: function(type) {
                const syarikatSubMenu = this.elements.syarikat;
                const peroduaHQSubMenu = this.elements.peroduaHQ;
                const targetAdvisorSubMenu = this.elements.targetServiceAdvisor;
                const targetTechSubMenu = this.elements.targetServiceTech;
                const afterWarrantySubMenu = this.elements.afterWarranty;

                syarikatSubMenu.style.display = 'none';
                peroduaHQSubMenu.style.display = 'none';
                targetAdvisorSubMenu.style.display = 'none';
                targetTechSubMenu.style.display = 'none';
                afterWarrantySubMenu.style.display = 'none';

                if (type === 'syarikat') {
                    syarikatSubMenu.style.display = 'block';
                } else if (type === 'peroduaHQ') {
                    peroduaHQSubMenu.style.display = 'block';
                } else if (type === 'targetServiceAdvisor') {
                    targetAdvisorSubMenu.style.display = 'block';
                } else if (type === 'targetServiceTech') {
                    targetTechSubMenu.style.display = 'block';
                } else if (type === 'afterWarranty') {
                    afterWarrantySubMenu.style.display = 'block';
                }
                
                this.elements.targetSubMenu.style.display = 'block';
            },

            showPartSubMenu: function(type) {
                const partPurchaseSubMenu = this.elements.partPurchase;
                const partPurchaseTargetSubMenu = this.elements.partPurchaseTarget;
                const remainingTargetSubMenu = this.elements.remainingTarget;
                const totalOrderingSubMenu = this.elements.totalOrdering;

                partPurchaseSubMenu.style.display = 'none';
                partPurchaseTargetSubMenu.style.display = 'none';
                remainingTargetSubMenu.style.display = 'none';
                totalOrderingSubMenu.style.display = 'none';

                if (type === 'partPurchase') {
                    partPurchaseSubMenu.style.display = 'block';
                } else if (type === 'partPurchaseTarget') {
                    partPurchaseTargetSubMenu.style.display = 'block';
                } else if (type === 'remainingTarget') {
                    remainingTargetSubMenu.style.display = 'block';
                    this.updateRemainingTarget();
                } else if (type === 'totalOrdering') {
                    totalOrderingSubMenu.style.display = 'block';
                }
                
                this.elements.partSubMenu.style.display = 'block';
            },

            showReportSubMenu: function(type) {
                const salesReport = this.elements.salesReport;
                const advisorReport = this.elements.advisorReport;
                const techReport = this.elements.techReport;

                salesReport.style.display = 'none';
                advisorReport.style.display = 'none';
                techReport.style.display = 'none';

                if (type === 'salesReport') {
                    salesReport.style.display = 'block';
                    this.generateSalesChart();
                } else if (type === 'advisorReport') {
                    advisorReport.style.display = 'block';
                    this.generateAdvisorChart();
                } else if (type === 'techReport') {
                    techReport.style.display = 'block';
                    this.generateTechChart();
                }
                
                this.elements.reportSubMenu.style.display = 'block';
            },

            generateSalesChart: function() {
                const start = new Date(this.elements.salesReportInputs.start.value);
                const end = new Date(this.elements.salesReportInputs.end.value);
                const filteredData = salesData.filter(data => {
                    const date = new Date(data.date);
                    return date >= start && date <= end;
                });

                const labels = filteredData.map(data => this.formatDate(data.date));
                const totals = filteredData.map(data => data.total);

                if (salesChart) salesChart.destroy();
                salesChart = new Chart(this.elements.salesReportInputs.chart, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Sales (RM)',
                            data: totals,
                            backgroundColor: 'rgba(163, 191, 250, 0.5)',
                            borderColor: 'rgba(163, 191, 250, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Amount (RM)'
                                }
                            }
                        }
                    }
                });
            },

            generateAdvisorChart: function() {
                const advisor = this.elements.advisorReportInputs.select.value;
                const start = new Date(this.elements.advisorReportInputs.start.value);
                const end = new Date(this.elements.advisorReportInputs.end.value);
                
                const filteredData = salesData.filter(data => {
                    const date = new Date(data.date);
                    return data.advisor === advisor && date >= start && date <= end;
                });

                const labels = filteredData.map(data => this.formatDate(data.date));
                const totals = filteredData.map(data => data.total);

                if (advisorChart) advisorChart.destroy();
                advisorChart = new Chart(this.elements.advisorReportInputs.chart, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: `${advisor} Sales (RM)`,
                            data: totals,
                            borderColor: 'rgba(251, 182, 206, 1)',
                            fill: false
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Amount (RM)'
                                }
                            }
                        }
                    }
                });
            },

            generateTechChart: function() {
                const tech = this.elements.techReportInputs.select.value;
                const start = new Date(this.elements.techReportInputs.start.value);
                const end = new Date(this.elements.techReportInputs.end.value);
                
                const filteredData = salesData.filter(data => {
                    const date = new Date(data.date);
                    return data.technician === tech && date >= start && date <= end;
                });

                const labels = filteredData.map(data => this.formatDate(data.date));
                const totals = filteredData.map(data => data.total);

                if (techChart) techChart.destroy();
                techChart = new Chart(this.elements.techReportInputs.chart, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: `${tech} Sales (RM)`,
                            data: totals,
                            backgroundColor: 'rgba(190, 227, 248, 0.5)',
                            borderColor: 'rgba(190, 227, 248, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Amount (RM)'
                                }
                            }
                        }
                    }
                });
            },

            generateSalesReport: function() {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                const start = this.elements.salesReportInputs.start.value;
                const end = this.elements.salesReportInputs.end.value;
                const filteredData = salesData.filter(data => {
                    const date = new Date(data.date);
                    return date >= new Date(start) && date <= new Date(end);
                });

                doc.setFontSize(16);
                doc.text('Sales Report', 105, 15, { align: 'center' });
                doc.setFontSize(12);
                doc.text(`Period: ${this.formatDate(start)} - ${this.formatDate(end)}`, 105, 25, { align: 'center' });

                const tableData = filteredData.map(data => [
                    this.formatDate(data.date),
                    this.formatCurrency(data.total)
                ]);
                doc.autoTable({
                    startY: 35,
                    head: [['Date', 'Total (RM)']],
                    body: tableData,
                });

                const chartImg = this.elements.salesReportInputs.chart.toDataURL('image/png');
                doc.addImage(chartImg, 'PNG', 15, doc.lastAutoTable.finalY + 10, 180, 100);

                doc.save(`sales_report_${start}_${end}.pdf`);
            },

            generateAdvisorReport: function() {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                const advisor = this.elements.advisorReportInputs.select.value;
                const start = this.elements.advisorReportInputs.start.value;
                const end = this.elements.advisorReportInputs.end.value;
                const filteredData = salesData.filter(data => {
                    const date = new Date(data.date);
                    return data.advisor === advisor && date >= new Date(start) && date <= new Date(end);
                });

                doc.setFontSize(16);
                doc.text(`Service Advisor Report - ${advisor}`, 105, 15, { align: 'center' });
                doc.setFontSize(12);
                doc.text(`Period: ${this.formatDate(start)} - ${this.formatDate(end)}`, 105, 25, { align: 'center' });

                const tableData = filteredData.map(data => [
                    this.formatDate(data.date),
                    this.formatCurrency(data.total)
                ]);
                doc.autoTable({
                    startY: 35,
                    head: [['Date', 'Total (RM)']],
                    body: tableData,
                });

                const chartImg = this.elements.advisorReportInputs.chart.toDataURL('image/png');
                doc.addImage(chartImg, 'PNG', 15, doc.lastAutoTable.finalY + 10, 180, 100);

                doc.save(`advisor_report_${advisor}_${start}_${end}.pdf`);
            },

            generateTechReport: function() {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                const tech = this.elements.techReportInputs.select.value;
                const start = this.elements.techReportInputs.start.value;
                const end = this.elements.techReportInputs.end.value;
                const filteredData = salesData.filter(data => {
                    const date = new Date(data.date);
                    return data.technician === tech && date >= new Date(start) && date <= new Date(end);
                });

                doc.setFontSize(16);
                doc.text(`Service Technician Report - ${tech}`, 105, 15, { align: 'center' });
                doc.setFontSize(12);
                doc.text(`Period: ${this.formatDate(start)} - ${this.formatDate(end)}`, 105, 25, { align: 'center' });

                const tableData = filteredData.map(data => [
                    this.formatDate(data.date),
                    this.formatCurrency(data.total)
                ]);
                doc.autoTable({
                    startY: 35,
                    head: [['Date', 'Total (RM)']],
                    body: tableData,
                });

                const chartImg = this.elements.techReportInputs.chart.toDataURL('image/png');
                doc.addImage(chartImg, 'PNG', 15, doc.lastAutoTable.finalY + 10, 180, 100);

                doc.save(`tech_report_${tech}_${start}_${end}.pdf`);
            }
        };

        UI.init();
    </script>
</body>
</html>